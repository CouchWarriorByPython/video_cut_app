{% extends "base.html" %}

{% block title %}–†–æ–∑–º—ñ—Ç–∫–∞ –≤—ñ–¥–µ–æ - Video Annotator{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/css/annotator.css">
{% endblock %}

{% block content %}
<h1>–†–æ–∑–º—ñ—Ç–∫–∞ –≤—ñ–¥–µ–æ</h1>

<!-- –°–ø–∏—Å–æ–∫ –≤—ñ–¥–µ–æ -->
<div id="videos-list-section" class="videos-list-section">
    <div class="section-header">
        <h2>–î–æ—Å—Ç—É–ø–Ω—ñ –≤—ñ–¥–µ–æ –¥–ª—è –∞–Ω–æ—Ç—É–≤–∞–Ω–Ω—è</h2>
        <div class="section-controls">
            <div class="videos-count">
                <span id="videos-count-text">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
            </div>
            <div class="auto-refresh-indicator">
                <div class="refresh-dot"></div>
                <span>–ê–≤—Ç–æ-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è</span>
            </div>
        </div>
    </div>

    <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
    <div class="filters-section">
        <div class="filter-group">
            <label for="status-filter">–°—Ç–∞—Ç—É—Å:</label>
            <select id="status-filter" class="form-control">
                <option value="">–í—Å—ñ —Å—Ç–∞—Ç—É—Å–∏</option>
                <option value="not_annotated">–ù–µ –∞–Ω–æ—Ç–æ–≤–∞–Ω—ñ</option>
                <option value="in_progress">–í –ø—Ä–æ—Ü–µ—Å—ñ –∞–Ω–æ—Ç–∞—Ü—ñ—ó</option>
                <option value="annotated">–ê–Ω–æ—Ç–æ–≤–∞–Ω—ñ</option>
            </select>
        </div>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü—è –≤—ñ–¥–µ–æ -->
    <div class="videos-table-container">
        <table class="videos-table" id="videos-table">
            <thead>
                <tr>
                    <th>–§–∞–π–ª</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</th>
                    <th>–ë–ª–æ–∫—É–≤–∞–Ω–Ω—è</th>
                    <th>–î—ñ—ó</th>
                </tr>
            </thead>
            <tbody id="videos-table-body">
                <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
    <div class="pagination-container" id="pagination-container">
        <!-- –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è JavaScript -->
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
    <div id="loading-status" class="loading-status hidden">
        <div class="loading-spinner"></div>
        <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–µ–æ...</p>
    </div>

    <!-- –ü–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω -->
    <div id="empty-state" class="empty-state hidden">
        <div class="empty-icon">üìπ</div>
        <h3>–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –≤—ñ–¥–µ–æ</h3>
        <p>–ü–æ–∫–∏ —â–æ –Ω–µ–º–∞—î –≤—ñ–¥–µ–æ –≥–æ—Ç–æ–≤–∏—Ö –¥–ª—è –∞–Ω–æ—Ç—É–≤–∞–Ω–Ω—è.</p>
    </div>
</div>

<!-- –†–µ–¥–∞–∫—Ç–æ—Ä –≤—ñ–¥–µ–æ -->
<div id="video-editor" class="hidden">
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3>–ê–Ω–æ—Ç—É–≤–∞–Ω–Ω—è –≤—ñ–¥–µ–æ</h3>
            <button id="back-to-list-btn" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É</button>
        </div>
        <p id="video-filename">–ù–∞–∑–≤–∞ —Ñ–∞–π–ª—É: <span></span></p>
        <div id="video-lock-info" class="video-lock-info">
            <span class="lock-icon">üîí</span>
            <span>–í—ñ–¥–µ–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ –¥–ª—è –≤–∞—Å –¥–æ <span id="lock-expires-time"></span></span>
        </div>
    </div>

    <!-- –í—ñ–¥–µ–æ —Å–µ–∫—Ü—ñ—è -->
    <div class="video-section">
        <div class="video-container">
            <video id="video-player" controls></video>
            <div id="timeline" class="timeline-container">
                <div id="timeline-progress" class="timeline-progress"></div>
            </div>
        </div>
    </div>

    <!-- –í–∏–±—ñ—Ä –ø—Ä–æ—î–∫—Ç—ñ–≤ -->
    <div class="card">
        <h3>–í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–æ—î–∫—Ç–∏ –¥–ª—è —Ä–æ–∑–º—ñ—Ç–∫–∏:</h3>
        <div class="checkbox-grid">
            <label class="checkbox-label">
                <input type="checkbox" name="project" value="motion_detection" checked> Motion Detection
            </label>
            <label class="checkbox-label">
                <input type="checkbox" name="project" value="military_targets_detection_and_tracking_moving"> Military Targets Moving
            </label>
            <label class="checkbox-label">
                <input type="checkbox" name="project" value="military_targets_detection_and_tracking_static"> Military Targets Static
            </label>
            <label class="checkbox-label">
                <input type="checkbox" name="project" value="re_id"> Re-identification
            </label>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ñ–≤ -->
    <div id="unfinished-fragments-status" class="unfinished-status"></div>

    <!-- –û—Å–Ω–æ–≤–Ω–∏–π –º–∞–∫–µ—Ç -->
    <div class="main-layout">
        <div class="left-column">
            <div class="card">
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button id="start-fragment" class="btn">–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ—á–∞—Ç–æ–∫ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—É</button>
                    <button id="end-fragment" class="btn" disabled>–í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –∫—ñ–Ω–µ—Ü—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç—É</button>
                    <button id="cancel-fragment" class="btn btn-secondary" disabled>–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                </div>

                <div class="fragment-list">
                    <h2>–§—Ä–∞–≥–º–µ–Ω—Ç–∏ –≤—ñ–¥–µ–æ</h2>
                    <div class="fragments-container">
                        <ul id="fragments-list"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-column">
            <div class="card meta-form">
                <h2>–ú–µ—Ç–∞–¥–∞–Ω—ñ –≤—ñ–¥–µ–æ</h2>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="skip-video" name="skip">
                        <span>Skip - –í—ñ–¥–µ–æ –ø–æ–≤–Ω—ñ—Å—Ç—é –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–µ (–∑–±–µ—Ä—ñ–≥–∞—î –±–µ–∑ –æ–±—Ä–æ–±–∫–∏ –∫–ª—ñ–ø—ñ–≤)</span>
                    </label>
                </div>

                <div class="form-group">
                    <label for="uav-type">UAV (—Ç–∏–ø –¥—Ä–æ–Ω–∞) <span style="color: #e74c3c;">*</span>:</label>
                    <select id="uav-type" name="uav_type" class="form-control">
                        {% for uav_type in uav_types %}
                        <option value="{{ uav_type.value }}">{{ uav_type.label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="video-content">–ö–æ–Ω—Ç–µ–Ω—Ç –≤—ñ–¥–µ–æ <span style="color: #e74c3c;">*</span>:</label>
                    <select id="video-content" name="video_content" class="form-control">
                        {% for content_type in video_content_types %}
                        <option value="{{ content_type.value }}">{{ content_type.label }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <h3>–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:</h3>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="is-urban" name="is_urban">
                            <span>Is urban</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="has-osd" name="has_osd">
                            <span>Has OSD</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="is-analog" name="is_analog">
                            <span>Is analog</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="night-video" name="night_video">
                            <span>Night video</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="multiple-streams" name="multiple_streams">
                            <span>Multiple streams</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="has-infantry" name="has_infantry">
                            <span>Has infantry</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="has-explosions" name="has_explosions">
                            <span>Has explosions</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="video-where">–õ–æ–∫–∞—Ü—ñ—è:</label>
                    <input type="text" id="video-where" name="where" class="form-control"
                           placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: Kyiv region –∞–±–æ Kharkiv city">
                    <small class="form-text">–¢—ñ–ª—å–∫–∏ –∞–Ω–≥–ª—ñ–π—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏. –ü—Ä–æ–±—ñ–ª–∏ –∑–∞–º—ñ–Ω—é—é—Ç—å—Å—è –Ω–∞ "_" –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ –≤–≤–æ–¥—É</small>
                </div>

                <div class="form-group">
                    <label for="video-when">–î–∞—Ç–∞ –∑–π–æ–º–∫–∏:</label>
                    <input type="text" id="video-when" name="when" class="form-control"
                           placeholder="20241220" maxlength="8">
                    <small class="form-text">–§–æ—Ä–º–∞—Ç: –†–†–†–†–ú–ú–î–î (—Ä—ñ–∫, –º—ñ—Å—è—Ü—å, –¥–µ–Ω—å). –ü—Ä–∏–∫–ª–∞–¥: 20241220 = 20 –≥—Ä—É–¥–Ω—è 2024</small>
                </div>
            </div>
        </div>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button id="save-annotation" class="btn btn-primary" style="flex: 1;">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∞–Ω–æ—Ç–∞—Ü—ñ—é</button>
        <button id="save-fragments" class="btn btn-success" style="flex: 1;">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç–∏ –∞–Ω–æ—Ç–∞—Ü—ñ—é</button>
    </div>
</div>
{% endblock %}

{% block modals %}
<!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –≤–∏–±–æ—Ä—É –ø—Ä–æ—î–∫—Ç—É -->
<div id="project-modal" class="modal">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3 class="modal-title">–í–∏–±–µ—Ä—ñ—Ç—å –ø—Ä–æ—î–∫—Ç</h3>
        <div class="modal-body" id="project-options"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="/js/annotator.js"></script>
{% endblock %}